---
title: "How we created the sample"
#output: 
 # html_document: 
    # css: /Library/Frameworks/R.framework/Versions/3.5/Resources/library/summarytools/includes/stylesheets
    # css: html/summarytools.css
bibliography: MX_WaterSurvey.bib
# nocite: '@*' # @* is a wildcard for all references. (ITEMS NOT MENTIONED THAT I WANT IN THE BIBLIOGRAPHY)
# nocite: |
# @riquelme_organismos_2018
---

How we obtained the Sample WSS Operators Mexico and what it looks like


```{r SETUP , echo=FALSE, message=FALSE}
# https://stackoverflow.com/questions/43549930/pdf-figures-not-shown-in-html-files-produced-by-rmarkdown-when-open-with-firefox
# to fix issue of picture not rendering TRY 
# devtools::install_github('yihui/knitr')

knitr::opts_chunk$set(fig.retina = 2,
                      tidy.opts = list(width.cutoff = 120),  # For code
                      options(width = 120) # For output
							 )  

#  The encoding ("ISO-8859-1") is not UTF-8. We will only support UTF-8 in the future. Please re-save your file "sample.Rmd" with the UTF-8 encoding.


# To generate tables using summarytool s own html rendering, the .Rmd document s configuration part (yaml) must point to the package s summarytools.css file.


```

```{r LOADPCK, echo=FALSE, message=FALSE}
library(tidyverse)
library(stringr)
library(forcats)
library(scales)
library(patchwork)
library(countrycode)
library(sf)
library(here)
library(kableExtra)
library(summarytools)


```






```{r COPYOUTPimage, echo=FALSE, message=FALSE}
# OKKIO, I am in /DataMEX, because it contains a file `.here`
library(here)
here::dr_here(show_reason = T)

from_dir <- here("07_output")
to_dir <- here("MexicoWaterSurvey", "output")

files <- list.files(path = from_dir , full.names = TRUE) #,  pattern = ".png$" )
move <- files[sapply(files, file.size) < 100000000] # < 100 MB or Github will get stuck

# --- SYNTAX
# file.copy(list.of.files, new.folder)

file.copy( move, to = to_dir , overwrite = T )
# if I had listed with full.names = F
# file.copy( file.path(from_dir, move), to = to_dir  )
```

```{r COPYOUTPdata, echo=FALSE, message=FALSE}
library(here)
here::dr_here(show_reason = T)

from_dir2 <- here("03_cleandata")
to_dir2 <- here("MexicoWaterSurvey", "data")

files2 <- list.files(path = from_dir2 , full.names = TRUE,  pattern =  "(^oper|^pres).*\\.Rdata$") 
move2 <- files2[sapply(files2, file.size) < 100000000] # < 100 MB or Github will get stuck

# --- SYNTAX
# file.copy(list.of.files, new.folder)
file.copy( move2, to = to_dir2 , overwrite = T )
```



## Sources of Data

1. The sample for the survey is mutuated from the sampling design of LAPOP

I looked into the STATA files with the sample of MX - 2016 which surveyd 1,563 IDs located in 260 **clusters** , which covered 110 **municipios** (since samples are proportional to the size of the population, larger municipios have more than one PSU (es Tijuana has 61 & 62))

LAPOP provided a file with geofences that indicate a circle containing each cluster in 2016 (slightly changed in 2018) 

2. In order to match official admin boundaries and shapefile (as in Census 2010), I downloaded from INEGI the ID keys and shapefiles (polygons) for  
+ Entidad (32) 
+ Municipios (2546)
+ Localidades URb( 4525 of 192,217 ) MULTiPOLYGON
+ Localidades Rur (187719 of 192,217) points 
+ AGEB urb- 56195 
 
3. Identification of (expected) clusters for POPA 2018 sample (based on LAPOP) & matching to INEGI keys admin boundaries (names and shapes)
	--> saved POPA Cluster size by Admin Bound in 
	--> saved SPJOIN RESULTS LAPOP FENCES intersected with Mun (Centroids and fences) 
	 

## Which Entidades and Municipios

The ENTIDADES and MUNICIPIOS INCLUDING LAPOP/POPA clusters (2016 --> closely followed in 2018)

```{r,  echo=FALSE, fig.cap="The ENTIDADES which include LAPOP clusters by # of hh interviewed in 2016", out.width = '100%', results='asis'}

# knitr::include_graphics(paste0(to_dir,"/01_tmap_PopaSampleE.png"))   # NOT RENDERING 

### #list.files(path = to_dir)
```	
	



![The ENTIDADES which include LAPOP clusters by # of hh interviewed in 2016](./output/01_tmap_PopaSampleE.png) 




```{r,  echo=FALSE, fig.cap="The MUNICIPIOS which include LAPOP clusters by # of hh interviewed in 2016", out.width = '100%', results='asis'}
# knitr::include_graphics(paste0(to_dir,"/01_tmap_PopaSampleM.png")) # NOT RENDERING 

### #list.files(path = to_dir)
```	

![The MUNICIPIOS which include LAPOP clusters by # of hh interviewed in 2016](./output/01_tmap_PopaSampleM.png) 


## Changes occurred between 2000-2010

Look at Changes in ENTIDADES and MUNICIPIOS covered by LAPOP/POPA clusters according to census 2010 compared to census 2000


......








## The Water & Sanitation Providers 

Look at THE WATER & SANITATION SERVICE PROVIDERS - SPECIFICALLY IN THE SURVEY AREA

INEGI has identified a total of 2688 _"prestadores"_ in the _"Censo de Captacion, Tratamiento y Suministro de Agua"_ 
conducted in 2014 and published in 2015. Of all of these, some 700 could be rightly defined as _"organismos operadores"_, i.e. 
entities specialized in the provision of the services of water and sanitation (regardless of their degree of autonomy in their 
decision making and financial management.

The service providers *"prestadores de los servicios de agua y saneamiento"* in Mexico are extremely heterogeneous in nature and conditions. 

In this project, the classification that we use is mostly derived from a _Nota Tecnica_ prepared by some colleagues of the IADB, WSA division [See @riquelme_organismos_2018, pp. 1-3]. This tracks some key information on **2,251 Prestadores**. 

```{r OperTIPO, echo=FALSE, message=FALSE, results = 'asis'}

load( here("MexicoWaterSurvey", "data", "prestadoresUTF.Rdata"))

# https://cran.r-project.org/web/packages/summarytools/vignettes/Introduction.html
library(summarytools)
Freq_Tipo <- summarytools::freq(prestadoresUTF$Tipo_lbl , 
			 report.nas = FALSE, 
			round.digits = 1, # default 2
			order = "freq", #  
			 style = 'rmarkdown', #  
			 omit.headings = T
			) 

# # Then use view(), like so:
#  view(Freq_Tipo, method = "pander", style = "rmarkdown", omit.headings = TRUE)
# 
# print(Freq_Tipo, style = "rmarkdown", report.nas = FALSE, 
#                  totals = FALSE, omit.headings = TRUE)
# # print(FreqTipo)
# 
# kable(FreqTipo) %>%
#   kable_styling("striped", full_width = F, latex_options = "scale_down") # %>%
#   #   row_spec(11, bold = T, color = "white", background = "#D7261E")


knitr::kable(Freq_Tipo, format = "pandoc", caption = "Title of the table")
```



### REFERENCE



```{r knitAttempt, echo = F, eval=F}
# knitr::knit2html('./sample.Rmd',encoding = 'UTF-8',force_v1 = TRUE)
```

